# 4. 엔티티 매핑

## 4.1 @Entity

`@Entity`가 붙은 클래스는 JPA가 관리하는 것으로, 엔티티라 부른다. 

### `@Entity` 적용 시 주의사항
* 기본 생성자는 필수다
* `final` 클래스, `enum`, `interface`, `inner` 클래스에는 사용할 수 없다.
* 저장할 필드에 `final`을 사용하면 안된다. 

## 4.6 기본 키 매핑

### JPA의 데이터베이스 기본 키 생성 전략
* 직접 할당: 기본 키를 애플리케이션에서 직접 할당한다.
* 자동 생성: 대리 키 사용 방식
  * IDENTITY: 기본 키 생성을 데이터베이스에 위임한다.
  * SEQUENCE: 데이터베이스 시퀀스를 사용해서 기본 키를 할당한다.
  * TABLE: 키 생성 테이블을 사용한다. 

### IDENTITY 식별자 생성 전략
엔티티가 영속 상태가 되려면 식별자가 반드시 필요하다. 그런데 IDENTITY 식별자 생성 전략은 엔티티를 데이터베이스에 저장해야 식별자를 구할 수 있으므로 em.persist()를 호출하는 즉시 INSERT SQL이 데이터베이스에 전달된다. 따라서 이 전략은 트랜잭션을 지원하는 쓰기 지연이 동작하지 않는다. 

### 권장하는 식별자 선택 전략

#### 데이터베이스 기본 키는 다음 3가지 조건을 모두 만족해야 한다.
1. null값은 허용하지 않는다.
2. 유일해야 한다.
3. **변해선 안 된다.**

#### 테이블의 기본 키를 선택하는 전략은 크게 2가지가 있다.
* 자연 키(natural key)
  * 비즈니스에 의미가 있는 키
  * 예) 주민등록번호, 이메일, 전화번호
* 대리 키(surrogate key)
  * 비즈니스와 관련 없는 임의로 만들어진 키, 대체 키로도 불린다.
  * 예) 오라클 시퀀스, auto_increment, 키생성 테이블 

#### 자연 키보다는 대리 키를 권장한다.
기본 키의 조건을 현재는 물론이고 미래까지 충족하는 자연 키를 찾기는 쉽지 않다. 대리 키는 비즈니스와 무관한 임의의 값이므로 요구사항이 변경되어도 기본 키가 변경되는 일은 드물다. (**권장: Long형 + 대리키 + 키 생성전략 사용**)

