# 5. 연관관계 매핑 기초

엔티티의 연관관계를 매핑할 때는 다음 3가지를 고려해야 한다.
* 다중성
* 단방향, 양방향
* 연관관계의 주인

## 다중성 

연관관계에는 다음과 같은 다중성이 있다.
* 다대일(`@ManyToOne`)
* 일대다(`@OneToMany`)
* 일대일(`@OneToOne`)
* 다대다(`@ManyToMany`)

보통 다대일과 일대다 관계를 가장 많이 사용하고 다대다 관계는 실무에서 거의 사용하지 않는다. 

## 단방향, 양방향

테이블은 외래 키 하나로 조인을 사용해서 양방향으로 쿼리가 가능하므로 사실상 방향이라는 개념이 없다. 반면에 객체는 참조용 필드를 가지고 있는 객체만 연관된 객체를 조회할 수 있다. 객체 관계에서 한 쪽만 참조하는 것을 단방향 관계라 하고, 양쪽이 서로 참조하는 것을 양방향 관계라 한다. 

## 연관관계의 주인

객체에는 양방향 연관관계라는 것이 없다. 서로 다른 단방향 연관관계 2개를 애플리케이션 로직으로 잘 묶어서 양방향인 것처럼 보이게 할 뿐이다. 반면에 데이터베이스 테이블은 외래 키 하나만으로 양방향 연관관계를 맺는다.        

이런 차이로 인해 JPA에서는 두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야 하는데 이것을 **연관관계의 주인**<sub>owner</sub>이라 한다. 

### 양방향 연관관계의 규칙
* 연관관계의 주인만이 외래 키를 관리(등록, 수정, 삭제)할 수 있다.
* 주인이 아닌 쪽은 읽기만 할 수 있다. (값을 수정해도 DB에 반영되지 않는다.)
* 주인이 아닌 쪽을 `mappedBy` 속성으로 표시한다.
* **연관관계의 주인 == 외래 키 관리자**

### 양방향 연관관계의 주의점

* 되도록이면 단방향 매핑만을 이용해 설계한다. 
* 양방향 연관관계 매핑 시 양쪽 방향에 모두 값을 입력해주는 것이 가장 안전하다.
  * 연관관계 편의 메소드를 이용한다. 
    ```java
        public class Member {

            private Team team;

            public void changeTeam(Team team) {
                this.team = team;
                team.getMembers().add(this); //**
            }
            ...
        }
    ```
